<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FlashDrop Pro - Workspace</title>
    <meta name="referrer" content="no-referrer-when-downgrade" />
    
    <script>(function(s){s.dataset.zone='10380251',s.src='https://gizokraijaw.net/vignette.min.js'})([document.documentElement, document.body].filter(Boolean).pop().appendChild(document.createElement('script')))</script>
    <script>(function(s){s.dataset.zone='10380245',s.src='https://nap5k.com/tag.min.js'})([document.documentElement, document.body].filter(Boolean).pop().appendChild(document.createElement('script')))</script>
    <script src="https://pl28342028.effectivegatecpm.com/a2/19/f7/a219f7c4a8d2e3bbeea9d014e51bb043.js"></script>
    <script>(function(ctxj){var d=document,s=d.createElement('script'),l=d.scripts[d.scripts.length-1];s.settings=ctxj||{};s.src="\/\/big-brief.com\/bCXiVts.dFG-l\/0pYpWucG\/me_mb9BucZCUfl\/kTP-T\/Ya3PMhzuQB5XNnTGARtBNfjycvzdNND\/ki1NM\/Qe";s.async=true;s.referrerPolicy='no-referrer-when-downgrade';l.parentNode.insertBefore(s,l);})({})</script>

    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <style>
        :root { --primary: #6366f1; --bg: #030712; --card: rgba(30, 41, 59, 0.85); --text: #f8fafc; --text-muted: #94a3b8; --border: #4f46e5; --nav-bg: rgba(15, 23, 42, 0.98); --danger: #ef4444; --success: #10b981; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; min-height: 100vh; overflow-x: hidden; display: flex; flex-direction: column; }
        
        /* 1. å¹¿å‘Šæ‹¦æˆªè­¦å‘Š - åˆå§‹å¿…é¡»éšè— */
        #adblock-warning { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 9999; justify-content: center; align-items: center; padding: 20px; text-align: center; }
        .warning-card { background: var(--card); padding: 30px; border-radius: 20px; border: 1px solid var(--danger); max-width: 400px; }

        .app-container { display: flex; flex-direction: column; min-height: 100vh; width: 100%; padding-top: 120px; }
        .stars-container { position: fixed; inset: 0; z-index: -1; background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%); }
        
        .navbar { position: fixed; top: 0; inset-x: 0; height: 110px; background: var(--nav-bg); border-bottom: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; backdrop-filter: blur(25px); }
        .logo { font-size: 30px; font-weight: 900; color: white; }
        .logo span { color: var(--primary); }
        .status-dot { width: 12px; height: 12px; border-radius: 50%; background: #666; margin-right: 8px; }
        .status-dot.online { background: var(--success); box-shadow: 0 0 10px var(--success); }

        .main-wrapper { display: flex; width: 100%; max-width: 1200px; margin: 0 auto; justify-content: center; gap: 20px; padding: 0 15px; }
        .content-area { flex: 1; max-width: 600px; display: flex; flex-direction: column; align-items: center; }
        .ad-side { width: 160px; height: 600px; position: sticky; top: 130px; border: 1px dashed var(--border); border-radius: 12px; overflow: hidden; background: rgba(30, 41, 59, 0.2); }
        @media (max-width: 950px) { .ad-side { display: none; } }

        /* 2. å‘é€ä»£ç åŒº - åˆå§‹å¿…é¡»éšè— */
        #senderCodeArea { display: none; margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); width: 100%; text-align: center; }
        
        /* 3. æ¥æ”¶æ–‡å­—åŒº - åˆå§‹å¿…é¡»éšè— */
        #receivedText-container { display: none; margin-top: 20px; background: rgba(99,102,241,0.1); border: 1px solid var(--primary); padding: 15px; border-radius: 18px; width: 100%; }

        .card { background: var(--card); padding: 25px; border-radius: 30px; backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); width: 100%; box-shadow: 0 20px 40px rgba(0,0,0,0.5); }
        .ad-space { background: rgba(30, 41, 59, 0.5); display: flex; justify-content: center; align-items: center; border: 1px dashed var(--border); border-radius: 12px; width: 100%; min-height: 90px; margin: 15px 0; }
        
        .legal-footer { padding: 40px 20px 80px 20px; font-size: 11px; color: var(--text-muted); border-top: 1px solid var(--border); background: #030712; display: flex; justify-content: center; gap: 30px; flex-wrap: wrap; margin-top: 40px; }
        .legal-section { flex: 1; min-width: 200px; max-width: 300px; }
        .legal-section h4 { color: white; font-size: 12px; margin-bottom: 10px; font-weight: 900; }
        .coffee-btn { border: 1.5px solid var(--primary); padding: 8px 16px; border-radius: 10px; color: var(--primary); text-decoration: none; font-weight: 900; display: inline-block; margin-bottom: 20px; }
        .contact-pill { background: rgba(99,102,241,0.1); color: var(--primary); padding: 4px 8px; border-radius: 5px; margin-right: 10px; text-decoration: none; font-size: 10px; }
        
        .tab-group { display: flex; background: rgba(51, 65, 85, 0.5); padding: 5px; border-radius: 15px; margin-bottom: 20px; }
        .tab { flex: 1; padding: 12px; text-align: center; cursor: pointer; border-radius: 12px; font-weight: 800; color: var(--text-muted); }
        .tab.active { background: var(--primary); color: white; }
        .panel { display: none; }
        .panel.active { display: block; }
        .share-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        @media (max-width: 500px) { .share-grid { grid-template-columns: 1fr; } }
        .file-zone { border: 2px dashed var(--border); border-radius: 15px; padding: 20px; text-align: center; cursor: pointer; background: rgba(15,23,42,0.4); }
        .text-zone { border: 1px solid var(--border); border-radius: 15px; padding: 15px; background: rgba(15,23,42,0.4); }
        textarea { background: transparent; border: none; color: white; width: 100%; height: 60px; resize: none; }
        .action-btn { background: var(--primary); color: white; border: none; padding: 14px; border-radius: 14px; width: 100%; font-weight: 800; cursor: pointer; margin-top: 10px; text-transform: uppercase; }
        .code-display { font-size: 50px; letter-spacing: 8px; font-weight: 900; color: #a5b4fc; margin: 15px 0; }
    </style>
</head>


<div id="adblock-warning">
    <div class="warning-card">
        <h3>AD-BLOCK DETECTED</h3>
        <p id="ad-block-p">FlashDrop needs ad revenue to maintain free servers. Please disable your Ad-blocker and refresh to continue.</p>
        <button class="action-btn" onclick="location.reload()" style="background:var(--danger)">I'VE DISABLED IT - REFRESH</button>
    </div>
</div>

<div class="app-container" id="app">
    <div class="stars-container" id="stars"></div>
    <nav class="navbar">
        <div class="logo-wrap"><div id="status-dot" class="status-dot"></div><div class="logo">âš¡ Flash<span>Drop</span> Pro</div><div id="currentLangTag" style="font-size:11px; color:var(--primary); font-weight:900; margin-left:12px; border:1.5px solid var(--primary); padding:2px 6px; border-radius:6px;">EN</div></div>
        <div class="trust-badges" id="trust-badges"></div>
    </nav>

    <div id="drop-zone"><h2 style="font-size:36px; color:white; font-weight:900;">DROP TO STAGE</h2></div>

    <div class="ad-space ad-top" id="top-ad-zone"></div>

    <div class="main-wrapper">
        <div class="ad-side" id="left-ad-zone"></div>

        <div class="content-area">
            
            <a href="mailto:flashdroppro@gmail.com" class="github-ad-box" id="notice-zone">
                <img src="ad_banner.jpg" alt="Notice" onerror="this.style.display='none'">
            </a>

            <div class="card">
                <div class="tab-group"><div id="tab-send" class="tab active" onclick="switchTab('send', event)">Send</div><div id="tab-receive" class="tab" onclick="switchTab('receive', event)">Receive</div></div>
                
                <div id="panel-send" class="panel active">
                    <div class="share-grid">
                        <div class="column-box">
                            <label class="file-zone" for="fileInput"><div style="font-size: 42px;">ğŸ“‚</div><div id="label-files" style="font-size:13px; margin-top:10px; font-weight:900;">Drop / Click</div></label>
                            <div id="stagedList"></div>
                            <button class="action-btn" id="btn-share-files" onclick="handleAdAndAction('send-file')">SHARE FILES</button>
                        </div>
                        <div class="column-box">
                            <div class="text-zone"><div id="label-text-hint" style="font-size:12px; color:var(--text-muted); font-weight:900;">Quick Text</div><textarea id="quickText" placeholder="Paste..."></textarea></div>
                            <button class="action-btn" id="btn-share-text" onclick="handleAdAndAction('send-text')">SHARE TEXT</button>
                        </div>
                    </div>
                    <div style="margin: 12px 0; font-size:12px; color:var(--text-muted); text-align:center;"><span id="label-limit">Limit:</span> <select id="downloadLimit" style="background:#0f172a; color:#fff; border:1.5px solid var(--border); padding:6px 12px; border-radius:8px;"><option value="1">1 Time</option><option value="3">3 Times</option><option value="5">5 Times</option><option value="7">7 Times</option><option value="999">Unlimited</option></select></div>
                    <input type="file" id="fileInput" multiple style="display:none;" onchange="handleFiles(this.files)">
                    <div id="senderCodeArea">
                        <div id="p2p-secure-tag" style="font-size:12px; color:var(--success); font-weight:900; margin-bottom:15px;">ğŸ›¡ï¸ P2P ENCRYPTED</div>
                        <p id="guideText" style="font-size:13px; color:var(--primary); font-weight:800; margin-bottom:18px; line-height:1.5;"></p>
                        <div id="qrcode"></div>
                        <div class="code-display" id="myCode">000000</div>
                        <div id="expiryTimer" style="font-size:13px; color:var(--danger); font-weight:900; margin-top:10px;">Expires: 10:00</div>
                        <button class="action-btn" id="btn-copy-link" style="background:#4f46e5; margin-top:15px;">ğŸ“‹ COPY FAST LINK</button>
                        <button class="action-btn" id="btn-stop" onclick="resetSender()" style="background:var(--danger); margin-top:15px;">STOP</button>
                    </div>
                </div>

                <div id="panel-receive" class="panel">
                    <div style="display:flex; flex-direction:column; align-items:center;">
                        <div class="receive-input-wrap">
                            <input type="number" id="targetCode" placeholder="000000" onkeydown="if(event.key==='Enter') handleAdAndAction('receive')">
                            <div class="divider-or" id="or-tag">OR</div>
                            <button class="action-btn" id="btn-scan" onclick="openScanner()" style="max-width: 260px; margin-bottom: 20px;">ğŸ“· SCAN QR CODE</button>
                        </div>
                        <button class="action-btn" id="btn-connect" onclick="handleAdAndAction('receive')" style="margin-top: 15px;">DOWNLOAD</button>
                        
                        <div id="receiveNerdStats" class="nerd-stats" style="display:none; width:100%; margin-top:20px;"><span id="nerd-speed">0.0 MB/s</span><span id="nerd-speed-label">MB/s</span></div>
                        <div id="mobileDownloadArea" style="display:none; width:100%; margin-top:15px; text-align:center;"><div id="receiveProgress" style="width:100%; height:10px; background:rgba(255,255,255,0.1); border-radius:12px; overflow:hidden; margin-bottom:15px;"><div id="receiveProgressBar" style="width:0%; height:100%; background:var(--success); transition:0.1s;"></div></div><button class="action-btn" id="btn-save-file" style="background:var(--success); padding:22px; font-size:18px;">ğŸ“¥ DOWNLOAD FILE NOW</button></div>
                        
                        <div id="receivedText-container">
                            <div style="font-size:11px; color:var(--text-muted); font-weight:900; margin-bottom:10px;">RECEIVED TEXT:</div>
                            <div id="receivedText" style="font-size:15px; color:white; word-break:break-all; max-height:120px; overflow-y:auto; margin-bottom:15px;"></div>
                            <button class="action-btn" style="padding:10px; font-size:11px; background:rgba(255,255,255,0.1);" onclick="copyReceivedText()">ğŸ“‹ COPY TEXT</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="history-box"><div class="history-title">Recent History (Local)</div><div id="history-list"></div></div>
            
            <div class="ad-space ad-bottom" id="bottom-ad-zone"></div>
        </div>

        <div class="ad-side" id="right-ad-zone"></div>
    </div>

    <footer class="legal-footer">
        <div class="legal-section" style="flex-basis: 100%; text-align: center; margin-bottom: 30px;">
            <a href="https://buymeacoffee.com/xiaevan199e" target="_blank" class="coffee-btn">â˜• Buy me a coffee</a>
        </div>

        <div class="legal-section">
            <h4>SECURITY PROTOCOL</h4>
            <p id="sec-protocol-p">DTLS 1.2 / SCTP Encrypted. Peer-to-Peer direct tunnel. No intermediate server storage.</p>
        </div>
        <div class="legal-section">
            <h4>PRIVACY POLICY</h4>
            <p id="foot-priv-p">Zero logs. Memory-only transmission. Data auto-destructs after transfer or 10 mins.</p>
        </div>

        <div class="legal-section">
            <h4>DEVELOPER</h4>
            <p>Â© 2025 FlashDrop Pro. Designed for high-risk, high-speed workspace security.</p>
        </div>
        <div class="legal-section">
            <h4>CONTACT US</h4>
            <a href="tel:9292664485" class="contact-pill">ğŸ“ +1 (929) 266-4485</a>
            <a href="mailto:flashdroppro@gmail.com" class="contact-pill">âœ‰ï¸ flashdroppro@gmail.com</a>
        </div>
    </footer>
</div>
<script>
// --- å¹¿å‘Šæ± é…ç½® ---
const SMART_LINKS = [
    "https://www.effectivegatecpm.com/p5akr5b1e?key=f3d45de493bf7cfb65c663950a6dfc8d", // Adsterra
    "https://otieu.com/4/10380243",                                                 // Monetag
    "https://limpfeel.com/MFoqkO"                                                   // HilltopAds
];

// --- å¹¿å‘Šä¸åŠ¨ä½œå¤„ç†é€»è¾‘ ---
function handleAdAndAction(actionType) {
    // 1. éšæœºæŒ‘é€‰ä¸€ä¸ªå¹¿å‘Šé“¾æ¥å¹¶å¼¹å‡º
    const randomLink = SMART_LINKS[Math.floor(Math.random() * SMART_LINKS.length)];
    window.open(randomLink, '_blank');

    // 2. æ ¹æ®æŒ‰é’®ç±»å‹æ‰§è¡Œå¯¹åº”çš„åŠŸèƒ½
    if (actionType === 'send-file') {
        shareFiles(); // æ‰§è¡Œåˆ†äº«æ–‡ä»¶é€»è¾‘
    } else if (actionType === 'send-text') {
        shareText();  // æ‰§è¡Œåˆ†äº«æ–‡å­—é€»è¾‘
    } else if (actionType === 'receive') {
        connectToPeer(); // æ‰§è¡Œæ¥æ”¶é€»è¾‘
    }
}

// --- åŠ¨æ€åŠ è½½ Banner å¹¿å‘Š ---
function loadBanners() {
    const topZone = document.getElementById('top-ad-zone');
    const bottomZone = document.getElementById('bottom-ad-zone');
    const leftZone = document.getElementById('left-ad-zone');
    const rightZone = document.getElementById('right-ad-zone');

    // Adsterra 728x90 Banner ä»£ç æ³¨å…¥ (ä¸Šä¸‹)
    const banner728 = `
        <script type="text/javascript">
            atOptions = { 'key' : 'fabada29768bc51cc0a6a76937a99ba9', 'format' : 'iframe', 'height' : 90, 'width' : 728, 'params' : {} };
        <\/script>
        <script type="text/javascript" src="https://www.highperformanceformat.com/fabada29768bc51cc0a6a76937a99ba9/invoke.js"><\/script>
    `;

    // Adsterra 160x600 Banner ä»£ç æ³¨å…¥ (å·¦å³)
    const banner160 = `
        <script type="text/javascript">
            atOptions = { 'key' : 'bd9abdb5a8bd5a53648a9afb54343727', 'format' : 'iframe', 'height' : 600, 'width' : 160, 'params' : {} };
        <\/script>
        <script type="text/javascript" src="https://www.highperformanceformat.com/bd9abdb5a8bd5a53648a9afb54343727/invoke.js"><\/script>
    `;

    if(topZone) topZone.innerHTML = banner728;
    if(bottomZone) bottomZone.innerHTML = banner728;
    if(leftZone) leftZone.innerHTML = banner160;
    if(rightZone) rightZone.innerHTML = banner160;
}

// --- æ¥æ”¶æ–‡å­—åçš„ UI è”åŠ¨ (ä¿®å¤è“åœˆé—®é¢˜) ---
function displayReceivedText(text) {
    const container = document.getElementById('receivedText-container');
    const displayArea = document.getElementById('receivedText');
    
    if (text) {
        displayArea.innerText = text;
        container.style.display = 'block'; // åªæœ‰æ”¶åˆ°å†…å®¹æ‰æ˜¾ç¤º
    } else {
        container.style.display = 'none';
    }
}

// --- æ ‡ç­¾é¡µåˆ‡æ¢é€»è¾‘ ---
function switchTab(type, e) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
    e.target.classList.add('active');
    document.getElementById('panel-' + type).classList.add('active');
}

// åˆå§‹åŒ–åŠ è½½
window.addEventListener('DOMContentLoaded', () => {
    loadBanners(); // é¡µé¢åŠ è½½åç«‹å³å¡«å……å¹¿å‘Š
});
</script>
<script>
let peer = null;
let conn = null;
let stagedFiles = [];
let myID = "";

// --- åˆå§‹åŒ– PeerJS ---
function initPeer() {
    const statusDot = document.getElementById('status-dot');
    peer = new Peer(Math.floor(100000 + Math.random() * 900000).toString(), {
        debug: 1,
        config: { 'iceServers': [{ 'urls': 'stun:stun.l.google.com:19302' }] }
    });

    peer.on('open', (id) => {
        myID = id;
        statusDot.className = 'status-dot online';
    });

    peer.on('connection', (c) => {
        conn = c;
        setupConnHandlers();
    });

    peer.on('error', () => {
        statusDot.className = 'status-dot offline';
        setTimeout(initPeer, 3000);
    });
}

// --- æ–‡ä»¶å¤„ç†ä¸æ‰“åŒ… ---
function handleFiles(files) {
    stagedFiles = Array.from(files);
    const list = document.getElementById('stagedList');
    list.innerHTML = stagedFiles.map(f => `<div style="font-size:12px; margin-top:5px;">ğŸ“„ ${f.name}</div>`).join('');
    list.style.display = 'block';
}

async function shareFiles() {
    if (stagedFiles.length === 0) return alert("Select files first!");
    
    // UI è½¬æ¢åˆ°æ˜¾ç¤ºéªŒè¯ç ç•Œé¢
    document.getElementById('senderCodeArea').style.display = 'block';
    document.getElementById('myCode').innerText = myID;
    document.getElementById('guideText').innerText = "Scan or enter code to download.";
    
    // ç”ŸæˆäºŒç»´ç 
    const qrDiv = document.getElementById('qrcode');
    qrDiv.innerHTML = "";
    new QRCode(qrDiv, { text: `https://flashdrop-pro.com/?c=${myID}`, width: 180, height: 180 });

    // å¤åˆ¶é“¾æ¥åŠŸèƒ½
    document.getElementById('btn-copy-link').onclick = () => {
        navigator.clipboard.writeText(`https://flashdrop-pro.com/?c=${myID}`);
        alert("Link Copied!");
    };
}

async function shareText() {
    const text = document.getElementById('quickText').value;
    if (!text) return alert("Enter text!");
    shareFiles(); // å¤ç”¨ ID æ˜¾ç¤ºé€»è¾‘
}

// --- è¿æ¥ä¸æ¥æ”¶é€»è¾‘ ---
function connectToPeer() {
    const targetID = document.getElementById('targetCode').value;
    if (!targetID) return alert("Enter 6-digit code!");
    
    conn = peer.connect(targetID);
    setupConnHandlers();
}

function setupConnHandlers() {
    conn.on('open', () => {
        // å¦‚æœæˆ‘æœ‰æš‚å­˜æ–‡ä»¶/æ–‡å­—ï¼Œè¿æ¥æˆåŠŸåç«‹åˆ»å‘å‡º
        const textData = document.getElementById('quickText').value;
        if (stagedFiles.length > 0) {
            sendDataAsZip();
        } else if (textData) {
            conn.send({ type: 'text', content: textData });
        }
    });

    conn.on('data', (data) => {
        if (data.type === 'text') {
            displayReceivedText(data.content); // è°ƒç”¨ Part 3 çš„ UI å‡½æ•°
            addToHistory('Text', 'Received');
        } else if (data.type === 'file') {
            const blob = new Blob([data.content], { type: 'application/zip' });
            const url = URL.createObjectURL(blob);
            const btn = document.getElementById('btn-save-file');
            document.getElementById('mobileDownloadArea').style.display = 'block';
            btn.onclick = () => {
                const a = document.createElement('a');
                a.href = url;
                a.download = `FlashDrop_${data.name}.zip`;
                a.click();
            };
            addToHistory('Files', 'Received');
        }
    });
}

async function sendDataAsZip() {
    const zip = new JSZip();
    stagedFiles.forEach(f => zip.file(f.name, f));
    const content = await zip.generateAsync({ type: "blob" });
    conn.send({ type: 'file', content: content, name: Date.now() });
    addToHistory('Files', 'Sent');
}

function addToHistory(type, action) {
    const list = document.getElementById('history-list');
    const entry = document.createElement('div');
    entry.style = "font-size:12px; padding:8px; border-bottom:1px solid #333; display:flex; justify-content:space-between;";
    entry.innerHTML = `<span>${action} ${type}</span><span style="color:var(--text-muted);">${new Date().toLocaleTimeString()}</span>`;
    list.prepend(entry);
}

function resetSender() { location.reload(); }

function copyReceivedText() {
    const text = document.getElementById('receivedText').innerText;
    navigator.clipboard.writeText(text);
    alert("Copied!");
}

// è‡ªåŠ¨å¡«å…… URL ä¸­çš„ Code
window.onload = () => {
    initPeer();
    const params = new URLSearchParams(window.location.search);
    const code = params.get('c');
    if (code) {
        document.getElementById('tab-receive').click();
        document.getElementById('targetCode').value = code;
    }
};
</script>
</body>
</html>
